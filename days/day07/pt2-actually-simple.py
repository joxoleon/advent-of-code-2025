from collections import deque

def count_timelines(grid):
    R, C = len(grid), len(grid[0])
    start_c = grid[0].index("S")
    memo = {}
    
    def bfs_simulate(r: int, c: int):
        if (r, c) in memo:
            return memo[(r, c)]
        
        if r == R:
            return 1

        count = 0
        cell = grid[r][c]
        if grid[r][c] == '^':
            # Both branches continue
            count += bfs_simulate(r + 1, c - 1)
            count += bfs_simulate(r + 1, c + 1)
        else:
            # straight down
            count += bfs_simulate(r + 1, c)
        memo[r, c] = count
        return count
    res = bfs_simulate(1, start_c)
    return res

# Load the example grid exactly as printed by AoC
example = [
".......S.......",
"...............",
".......^.......",
"...............",
"......^.^......",
"...............",
".....^.^.^.....",
"...............",
"....^.^...^....",
"...............",
"...^.^...^.^...",
"...............",
"..^...^.....^..",
"...............",
".^.^.^.^.^...^.",
"...............",
]

example2 = [
"......................................................................S......................................................................",
".............................................................................................................................................",
"......................................................................^......................................................................",
".............................................................................................................................................",
".....................................................................^.^.....................................................................",
".............................................................................................................................................",
"....................................................................^...^....................................................................",
".............................................................................................................................................",
"...................................................................^.^...^...................................................................",
".............................................................................................................................................",
"..................................................................^.^...^.^..................................................................",
".............................................................................................................................................",
".................................................................^.^...^.^.^.................................................................",
".............................................................................................................................................",
"................................................................^.^...^.^.^.^................................................................",
".............................................................................................................................................",
"...............................................................^.......^.^.^.^...............................................................",
".............................................................................................................................................",
"..............................................................^.^.^.^...^.....^..............................................................",
".............................................................................................................................................",
".............................................................^.^.^.^.^.^.......^.............................................................",
".............................................................................................................................................",
"............................................................^...^.^.^...^...^...^............................................................",
".............................................................................................................................................",
"...........................................................^.^.^.....^.^.^.^.....^...........................................................",
".............................................................................................................................................",
"..........................................................^.^.....^.^.^.^.^.^.....^..........................................................",
".............................................................................................................................................",
".........................................................^.^.^.^.^.^...^.....^...^.^..........................................................",
".............................................................................................................................................",
"........................................................^.^.^.^.....^...^.^.^.^.^...^........................................................",
".............................................................................................................................................",
".......................................................^.^.^...^.^.^.^.^.......^.^.^.^.......................................................",
".............................................................................................................................................",
"......................................................^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^......................................................",
".............................................................................................................................................",
".....................................................^.^.....^.^.^.^.^...^.^.......^...^.....................................................",
".............................................................................................................................................",
"....................................................^.^...^.^.^...^...^.^.......^...^...^....................................................",
".............................................................................................................................................",
"...................................................^...^...^.....^.^.^...^.^.^.^.^...^.^.^...................................................",
".............................................................................................................................................",
"..................................................^.^.^.^.^.^.....^.^...^.....^...^.....^.^..................................................",
".............................................................................................................................................",
".................................................^.^.^.^.^...^.....^.^...^.^.....^...^.^...^.................................................",
".............................................................................................................................................",
"................................................^...^.^.^.^.^.^.^...^.....^.^.^.^.^.^.^.^...^................................................",
".............................................................................................................................................",
"...............................................^...^.^...^.^...^.^.^.^...^.^.^.^.^.^.^.^.^.^.^...............................................",
".............................................................................................................................................",
"..............................................^.^.^.^.^.....^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^..............................................",
".............................................................................................................................................",
".............................................^.^.....^.^...^...^.^.......^.^.^.^.....^...^.^.^.^.............................................",
".............................................................................................................................................",
"............................................^.^...^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.....^.^............................................",
".............................................................................................................................................",
"...........................................^.^.^.^.^...^.......^.^...^.......^.^.^.^...^.^.....^.^...........................................",
".............................................................................................................................................",
"..........................................^...^.^.^...^...^.^.^...^.^.^...........^.^.^.^...^.^.^.^..........................................",
".............................................................................................................................................",
".........................................^...^.^...^.^.^.^...^.^.^.^.^.^.^.^.^...^.^...^.^.^.^...^.^.........................................",
".............................................................................................................................................",
"........................................^...^...^.^.^.^.^.^.......^.^.^.^.^.^.^.^.....^...^...^.^.^.^........................................",
".............................................................................................................................................",
".......................................^.^...^.^.^...^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.......................................",
".............................................................................................................................................",
"......................................^.^.....^.......^.^.^.^.^.^.^.^.....^.^.^.^.^.^.^.^.....^.^.....^......................................",
".............................................................................................................................................",
".....................................^...^.^...^...^.....^.^.^...^.^...^.^...^.^.....^.......^.^.^.^.^.^.....................................",
".............................................................................................................................................",
"....................................^.......^...^.^...^.^.^.^.^...^...^.^.^...^.^...^.^.^.^.....^.^.^...^....................................",
".............................................................................................................................................",
"...................................^.^.^.^...^...^.^.^.^.^.^.^.^.^.^...^.^.^.^.^...^...^.^...^.^...^.....^...................................",
".............................................................................................................................................",
"..................................^.^.^.^.....^.....^...^.^.^.^.^.^.^.^...^.^.^.^.^...^.^.^...^.^...^.^.^.^..................................",
".............................................................................................................................................",
".................................^.^.^.^.....^...^.^.....^...^...^...^.^...^.^.....^.^.^.^.^...^.^.^.......^.................................",
".............................................................................................................................................",
"................................^.^.^.^.^.^.^.^...^.^.^...^...^.^.^...^.^.^...^.^.....^.^.^.......^...^.^.^.^................................",
".............................................................................................................................................",
"...............................^.^.^...^.^.....^.^...^.......^.^...^.^.^...^...^.^.^.^.^...^.^...^.^.^.......^...............................",
".............................................................................................................................................",
"..............................^.^...^.^.^.^.^.......^...^.^.....^.^...^.^.^.^...^.^.^.^.^.^...^.^.^.^.^...^.^.^..............................",
".............................................................................................................................................",
".............................^...^.^.^.^.^.^...^.....^.....^.^.^.........^.^.^...^.^.^.^.^...^.^.^...^.^...^.^.^.............................",
".............................................................................................................................................",
"............................^...^.^.....^.^.^.....^.......^...^...^...^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^...^.^.^............................",
".............................................................................................................................................",
"...........................^.^.....^...^.^.^.^.^...^...^.....^.^.^...^.^.^.^.^.^.^...^.^.^.^.^.^.....^...^...^.^.^...........................",
".............................................................................................................................................",
"..........................^.^.^.^.^.^...^.^.^...^.^.^...^.....^.^.^.^.^.^.....^.^.....^.^.^...^.^.^.^...^.^.^.^...^..........................",
".............................................................................................................................................",
".........................^.^...^...^.^.^.....^.^.^...^.^.....^.^.^.^.^.^.^.^.....^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.........................",
".............................................................................................................................................",
"........................^.^.......^.^...^...^.^.^...^.....^.^.^.^.^...^.^.^.^.^.^.^.^...^...^.....^...^.^...........^........................",
".............................................................................................................................................",
".......................^.^.^.......^.^.^.^...^.^.^.^...^.^.^...^.^.^.^...^.^.^.........^.^.^.^.^...^.^.^.^.^.......^.^.......................",
".............................................................................................................................................",
"......................^.^.^.......^...^.^.^...^...^.^.^.......^.^...^.^.^.^.^.^.^.^...^.....^...^.^.^...^.....^.^.^.^.^......................",
".............................................................................................................................................",
".....................^.^...^...^.^...^.^.^.......^.......^.^.^.^...^...^...^.^...^.^.^.^.^.^.....^...^.^...^...^.^.....^.....................",
".............................................................................................................................................",
"....................^...^.^.^.^...^...^.^.^...^.^.^.^.^.^...^.^...^...^.^.^.^.^.^.^.^.^...^...^.^...^...^.^.^.^.^.^.^...^....................",
".............................................................................................................................................",
"...................^.^.^.^.^.^.^.....^.....^.^.^.^...^.^.^.^.^.^.^.^.^...^...^...^...^.^.^.^.^.^...^.^.^.^.....^.^.^.....^...................",
".............................................................................................................................................",
"..................^.^.^.^...^.^.^...^.^.^.^.^.^...^.^...^.^.^.^.^...^.^.^.^...^.^.....^.^.^.^...^.^.^...^.....^.^.^.^.^.^.^..................",
".............................................................................................................................................",
".................^.^...^.^.^.^.^.^.^.....^.^.^...^.^.^.^.^.^.^...^.^.^.^.^...^.....^.....^.^.....^...^...^.^.^.^.^.^...^.^.^.................",
".............................................................................................................................................",
"................^.^.^...^.^.^.^.^...^.^.^.^...^.....^.^.^.....^.^.^.^.^.^.^...^...^.^.^.^...^.^...^.^.^.^.^.^...^.^.^.^...^.^................",
".............................................................................................................................................",
"...............^.^...^.^.^...^.^.^.^.^...^.^.^...^.^.^.^.....^...^.^.^.....^.........^.^.^...^...^...^.^.....^.^.^.^.^.^.^.^.^...............",
".............................................................................................................................................",
"..............^...^.^.^...^.^.^...^.^.^.^...^...^.^.^...^.^.^.^.....^...^.....^.^.^.^.^.^.......^.^.....^.^.^.....^.^...^...^.^..............",
".............................................................................................................................................",
".............^.^.^.^.^.^.....^...^.^.^.....^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^...^.^...^...^...^.^.^...^...^...^.^.^.^.^.^.............",
".............................................................................................................................................",
"............^.^.^.....^...^.^.^.^.....^.^...^.^...^.^.^.^.^.^.^...^.......^.^.^.........^.^...^...^.^.^...^.^.^.^.^.^...^...^.^.^............",
".............................................................................................................................................",
"...........^.^.^...^.^.^.^.^...^...^.^.^.^.^.^.^.^.^.^.^...^.^...^.^...^...^...^...^.^.^.^.....^.^.........^.^...^.^.^.^.^.^.^.^.^...........",
".............................................................................................................................................",
"..........^...^.......^.^.......^...........^.^.^.......^.^.^.^.^.^...^.........^.^.^...^.^.^...^.^.^.....^.^.^.^.^.^.^...^.^...^.^..........",
".............................................................................................................................................",
".........^...^...^.^.^...^.^...^.^.....^.^...^.^.^.^.^.^.^.^...^.^.....^.^.^.....^.^.^.^.........^.^...^.^.^.^.........^.^.....^...^.........",
".............................................................................................................................................",
"........^.^.^.^...^...^...^...^.^.....^.....^.^.^...^...^.^.^.^.^.......^.^...^.^.^.^.^.....^.^.......^...^.^.^.^...^...^...^.^...^.^........",
".............................................................................................................................................",
".......^.^...^.^...^...^.^...^.^.^...^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^...^...^.^.^.^.^.^.^.^.^...^.^.^.^...^.^.^...^.....^.^.^.^.......",
".............................................................................................................................................",
"......^...^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^...^.^.^.....^...^...^.^.^.^.^.^...^.^.^.....^.^.^.....^.^.....^.^...^.^.^.^.^...^.....^......",
".............................................................................................................................................",
".....^.^.^.....^.^.....^.....^.^.^.^...^.^.^.^.^.^...^.^.^...^.^.^.^.^.^...^.^.....^.....^.^...^.....^.^.^.........^.^...^...^...^...^.^.....",
".............................................................................................................................................",
"....^...^.^.^.^.^.^...^...^...^...^...^.^.^.^...^.^.^...^.^.^.^.^...^.^.^.^.^...^...^.^.^...^.....^.^.^.^.^.^...^.^.....^.^.^.^.^...^.^.^....",
".............................................................................................................................................",
"...^.^.^.^...^.^.^.......^.^.^.^.^.^.^...^.^.^.^.....^.^.......^.^.....^.^...^.^.^.^.....^.^.^.^.......^.....^.......^.^...^.^...^.^...^.^...",
".............................................................................................................................................",
"..^...^.^.^.^.^...^...^...^...^.^...^...^.^.........^.^.^...^...^.^.^.^.^.^.^.....^.^.^.^.^.^.....^.^...^.^...^.^...^...^...^...^.^.^...^.^..",
".............................................................................................................................................",
".^.^.^.^.^.^.^...^.^.^.^.^.^.^...^.^.^.^.^.^.^.^...^.^.^.......^...^.^.^.....^...^...^.......^...^.^.^.^...^.....^.^...^.......^.^.^.^.^...^.",
"............................................................................................................................................."
]
grid = [list(row) for row in example2]
print(count_timelines(grid))